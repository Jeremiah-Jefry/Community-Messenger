{% extends "base.html" %}
{% block content %}
<style>
    .chat-container { display: flex; height: calc(100vh - 64px); }
    .chat-pane { flex-grow: 1; display: flex; flex-direction: column; background-color: var(--bg-primary); }
    .chat-header {
        background-color: var(--bg-surface);
        padding: 0.75rem 1.5rem;
        border-bottom: 1px solid var(--border-color);
        box-shadow: var(--shadow-sm);
    }
    .chat-header h4 {
        color: var(--text-primary);
        font-weight: 700;
        font-size: 1.1rem;
    }
    .chat-box { flex-grow: 1; overflow-y: auto; padding: 1.25rem; }
    .chat-message { display: flex; margin-bottom: 0.75rem; }
    .chat-message.current-user { justify-content: flex-end; }

    .chat-message .message-content {
        padding: 0.65rem 0.9rem;
        border-radius: 12px;
        background-color: #f1f5f9;
        max-width: 70%;
        color: var(--text-primary);
    }
    .chat-message.current-user .message-content {
        background-color: var(--accent-color);
        color: #ffffff;
    }
    .chat-message .username {
        font-weight: 600;
        margin-bottom: 2px;
        font-size: 0.8em;
        color: var(--text-secondary);
    }
    .chat-message.current-user .username {
        color: rgba(255, 255, 255, 0.8);
    }
    .chat-message .timestamp {
        font-size: 0.7rem;
        color: var(--text-secondary);
        margin-top: 4px;
        opacity: 0.7;
    }
    .chat-message.current-user .timestamp {
        color: rgba(255, 255, 255, 0.65);
    }

    .users-sidebar {
        width: 240px;
        background-color: var(--bg-surface);
        border-left: 1px solid var(--border-color);
        padding: 1rem;
        overflow-y: auto;
    }
    .users-sidebar h5 {
        color: var(--text-secondary);
        text-transform: uppercase;
        font-size: 0.75rem;
        font-weight: 600;
        letter-spacing: 0.05em;
    }
    .user-list-item {
        list-style: none;
        color: var(--text-primary);
        padding: 0.4rem 0;
        font-size: 0.9rem;
    }
    .chat-input-bar {
        background-color: var(--bg-surface);
        border-top: 1px solid var(--border-color);
        padding: 0.75rem 1rem;
    }
    .chat-input-bar .form-control {
        background-color: var(--bg-primary);
        border: 1px solid var(--border-color);
    }
    .chat-input-bar .form-control:focus {
        background-color: var(--input-bg);
    }
</style>

<div class="chat-container">
    <div class="chat-pane">
        <div class="chat-header"><h4 class="mb-0"># {{ group.name }}</h4></div>
        <div id="messages" class="chat-box">
            {% for message in messages %}
            <div class="chat-message {% if message.user.username == user.username %}current-user{% endif %}">
                <div class="message-content">
                    <div class="username">{{ message.user.username }}</div>
                    <div>{{ message.text }}</div>
                    <div class="timestamp text-end">{{ message.timestamp|to_ist }}</div>
                </div>
            </div>
            {% endfor %}
        </div>
        <form id="chatForm" class="d-flex chat-input-bar">
            <input id="msgInput" class="form-control me-2" autocomplete="off" placeholder="Message #{{ group.name }}..." required>
            <button class="btn btn-accent">Send</button>
        </form>
    </div>
    <div class="users-sidebar">
        <h5>Online â€” <span id="online-user-count">0</span></h5>
        <ul id="online-user-list" class="list-unstyled"></ul>
    </div>
</div>

<script src="https://cdn.socket.io/4.5.4/socket.io.min.js"></script>
<script>
  const USERNAME = "{{ user.username }}";
  const GROUP_ID = "{{ group.id }}";
</script>
<script src="{{ url_for('static', filename='chat.js') }}"></script>
{% endblock %}
