{% extends "base.html" %}
{% block content %}
<style>
    .chat-container { display: flex; height: calc(100vh - 56px); }
    .chat-pane { flex-grow: 1; display: flex; flex-direction: column; background-color: var(--bg-secondary); }
    .chat-header { background-color: var(--bg-tertiary); padding: 0.75rem 1.5rem; border-bottom: 1px solid rgba(0, 0, 0, 0.2); }
    .chat-box { flex-grow: 1; overflow-y: auto; padding: 1rem; }
    .chat-message { display: flex; align-items: baseline; padding: 0.25rem 0; line-height: 1.5; word-wrap: break-word; }
    .chat-message .timestamp { font-size: 0.75rem; color: #72767d; margin-right: 10px; flex-shrink: 0; }
    .chat-message .content { display: inline; }
    .chat-message .content b { color: white; font-weight: 600; margin-right: 8px; }
    .users-sidebar { width: 240px; background-color: var(--bg-tertiary); border-left: 1px solid rgba(0, 0, 0, 0.2); padding: 1rem; overflow-y: auto; }
    .users-sidebar h5 { color: #96989d; text-transform: uppercase; font-size: 0.8rem; font-weight: bold; }
    .user-list-item { list-style: none; color: var(--text-color); padding: 5px 0; }
</style>

<div class="chat-container">
    <div class="chat-pane">
        <div class="chat-header"><h4 class="mb-0 text-white"># {{ group.name }}</h4></div>
        <div id="messages" class="chat-box">
            {% for message in messages %}
            <div class="chat-message">
                <span class="timestamp">{{ message.timestamp.strftime('%I:%M %p') }}</span>
                <div class="content"><b>{{ message.user.username }}</b><span>{{ message.text }}</span></div>
            </div>
            {% endfor %}
        </div>
        <form id="chatForm" class="d-flex p-3 border-top" style="background-color: #36393f;">
            <input id="msgInput" class="form-control me-2" style="background-color: #40444b; border:none;" autocomplete="off" placeholder="Message #{{ group.name }}..." required>
            <button class="btn btn-accent">Send</button>
        </form>
    </div>
    <div class="users-sidebar">
        <h5>Online â€” <span id="online-user-count">0</span></h5>
        <ul id="online-user-list" class="list-unstyled"></ul>
    </div>
</div>

<script src="https://cdn.socket.io/4.5.4/socket.io.min.js"></script>
<script>
  const USERNAME = "{{ user.username }}";
  const GROUP_ID = "{{ group.id }}";
</script>
<script src="{{ url_for('static', filename='chat.js') }}"></script>
{% endblock %}