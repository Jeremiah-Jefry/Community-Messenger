{% extends "base.html" %}
{% block content %}
<style>
    .chat-container { display: flex; height: calc(100vh - 56px); }
    .chat-pane { flex-grow: 1; display: flex; flex-direction: column; background-color: var(--bg-secondary); }
    .chat-header { background-color: var(--bg-tertiary); padding: 0.75rem 1.5rem; border-bottom: 1px solid rgba(0, 0, 0, 0.2); }
    .chat-box { flex-grow: 1; overflow-y: auto; padding: 1rem; }
    .chat-message { display: flex; margin-bottom: 1rem; }
    /* Adjust flex direction for current user's messages if you still want right alignment */
    .chat-message.current-user { justify-content: flex-end; } /* Pushes message to the right */

    .chat-message .message-content {
        padding: 0.75rem;
        border-radius: 10px;
        background-color: var(--bg-tertiary);
        max-width: 70%; /* Limit message bubble width */
    }
    .chat-message.current-user .message-content { background-color: var(--accent-color); }
    .chat-message .username { font-weight: bold; margin-bottom: 2px; font-size: 0.9em;} /* Slightly smaller username */
    .chat-message .timestamp { font-size: 0.75rem; color: #72767d; margin-top: 5px;}

    /* Styling for messages from others */
    .chat-message:not(.current-user) .message-content {
        margin-left: 0; /* Remove avatar space */
    }
    /* Styling for messages from current user */
    .chat-message.current-user .message-content {
        margin-right: 0; /* Remove avatar space */
    }

    .users-sidebar { width: 240px; background-color: var(--bg-tertiary); border-left: 1px solid rgba(0, 0, 0, 0.2); padding: 1rem; overflow-y: auto; }
    .users-sidebar h5 { color: #96989d; text-transform: uppercase; font-size: 0.8rem; font-weight: bold; }
    .user-list-item { list-style: none; color: var(--text-color); padding: 5px 0; }
</style>

<div class="chat-container">
    <div class="chat-pane">
        <div class="chat-header"><h4 class="mb-0 text-white"># {{ group.name }}</h4></div>
        <div id="messages" class="chat-box">
            {% for message in messages %}
            <div class="chat-message {% if message.user.username == user.username %}current-user{% endif %}">
                <div class="message-content">
                    <div class="username">{{ message.user.username }}</div>
                    <div>{{ message.text }}</div>
                    <div class="timestamp text-end">{{ message.timestamp|to_ist }}</div>
                </div>
            </div>
            {% endfor %}
        </div>
        <form id="chatForm" class="d-flex p-3 border-top" style="background-color: #36393f;">
            <input id="msgInput" class="form-control me-2" style="background-color: #40444b; border:none;" autocomplete="off" placeholder="Message #{{ group.name }}..." required>
            <button class="btn btn-accent">Send</button>
        </form>
    </div>
    <div class="users-sidebar">
        <h5>Online â€” <span id="online-user-count">0</span></h5>
        <ul id="online-user-list" class="list-unstyled"></ul>
    </div>
</div>

<script src="https://cdn.socket.io/4.5.4/socket.io.min.js"></script>
<script>
  const USERNAME = "{{ user.username }}";
  const GROUP_ID = "{{ group.id }}";
</script>
<script src="{{ url_for('static', filename='chat.js') }}"></script>
{% endblock %}